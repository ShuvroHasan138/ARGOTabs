$(document).ready(function(){module("Collections"),test("each",function(){_.each([1,2,3],function(t,e){equal(t,e+1,"each iterators provide value and iteration count")});var t=[];_.each([1,2,3],function(e){t.push(e*this.multiplier)},{multiplier:5}),equal(t.join(", "),"5, 10, 15","context object property accessed"),t=[],_.forEach([1,2,3],function(e){t.push(e)}),equal(t.join(", "),"1, 2, 3",'aliased as "forEach"'),t=[];var e={one:1,two:2,three:3};e.constructor.prototype.four=4,_.each(e,function(e,n){t.push(n)}),equal(t.join(", "),"one, two, three","iterating over objects works, and ignores the object prototype."),delete e.constructor.prototype.four;var n=null;_.each([1,2,3],function(t,e,r){_.include(r,t)&&(n=!0)}),ok(n,"can reference the original collection from inside the iterator"),t=0,_.each(null,function(){++t}),equal(t,0,"handles a null properly")}),test("map",function(){var t=_.map([1,2,3],function(t){return 2*t});equal(t.join(", "),"2, 4, 6","doubled numbers"),t=_.collect([1,2,3],function(t){return 2*t}),equal(t.join(", "),"2, 4, 6",'aliased as "collect"');var e=_.map([1,2,3],function(t){return t*this.multiplier},{multiplier:3});equal(e.join(", "),"3, 6, 9","tripled numbers with context");var t=_([1,2,3]).map(function(t){return 2*t});if(equal(t.join(", "),"2, 4, 6","OO-style doubled numbers"),document.querySelectorAll){var n=_.map(document.querySelectorAll("#map-test *"),function(t){return t.id});deepEqual(n,["id1","id2"],"Can use collection methods on NodeLists.")}var n=_.map($("#map-test").children(),function(t){return t.id});deepEqual(n,["id1","id2"],"Can use collection methods on jQuery Array-likes.");var n=_.map(document.images,function(t){return t.id});ok("chart_image"==n[0],"can use collection methods on HTMLCollections");var r=_.map(null,function(){});ok(_.isArray(r)&&0===r.length,"handles a null properly")}),test("reduce",function(){var t=_.reduce([1,2,3],function(t,e){return t+e},0);equal(t,6,"can sum up an array");var e={multiplier:3};t=_.reduce([1,2,3],function(t,e){return t+e*this.multiplier},0,e),equal(t,18,"can reduce with a context object"),t=_.inject([1,2,3],function(t,e){return t+e},0),equal(t,6,'aliased as "inject"'),t=_([1,2,3]).reduce(function(t,e){return t+e},0),equal(t,6,"OO-style reduce");var t=_.reduce([1,2,3],function(t,e){return t+e});equal(t,6,"default initial value");var n;try{_.reduce(null,function(){})}catch(r){n=r}ok(n instanceof TypeError,"handles a null (without inital value) properly"),ok(138===_.reduce(null,function(){},138),"handles a null (with initial value) properly"),equal(_.reduce([],function(){},void 0),void 0,"undefined can be passed as a special case"),raises(function(){_.reduce([],function(){})},TypeError,"throws an error for empty arrays with no initial value")}),test("reduceRight",function(){var t=_.reduceRight(["foo","bar","baz"],function(t,e){return t+e},"");equal(t,"bazbarfoo","can perform right folds");var t=_.foldr(["foo","bar","baz"],function(t,e){return t+e},"");equal(t,"bazbarfoo",'aliased as "foldr"');var t=_.foldr(["foo","bar","baz"],function(t,e){return t+e});equal(t,"bazbarfoo","default initial value");var e;try{_.reduceRight(null,function(){})}catch(n){e=n}ok(e instanceof TypeError,"handles a null (without inital value) properly");var r=_.reduceRight({a:1,b:2,c:3},function(t,e){return t+e});equal(r,6,"default initial value on object"),ok(138===_.reduceRight(null,function(){},138),"handles a null (with initial value) properly"),equal(_.reduceRight([],function(){},void 0),void 0,"undefined can be passed as a special case"),raises(function(){_.reduceRight([],function(){})},TypeError,"throws an error for empty arrays with no initial value");var i,o={},a={a:1,b:2},s=_.keys(a).pop(),u="a"==s?[o,1,"a",a]:[o,2,"b",a];_.reduceRight(a,function(){i||(i=_.toArray(arguments))},o),deepEqual(i,u),a={2:"a",1:"b"},s=_.keys(a).pop(),i=null,u="2"==s?[o,"a","2",a]:[o,"b","1",a],_.reduceRight(a,function(){i||(i=_.toArray(arguments))},o),deepEqual(i,u)}),test("find",function(){var t=[1,2,3,4];strictEqual(_.find(t,function(t){return t>2}),3,"should return first found `value`"),strictEqual(_.find(t,function(){return!1}),void 0,"should return `undefined` if `value` is not found")}),test("detect",function(){var t=_.detect([1,2,3],function(t){return 4==2*t});equal(t,2,'found the first "2" and broke the loop')}),test("select",function(){var t=_.select([1,2,3,4,5,6],function(t){return 0==t%2});equal(t.join(", "),"2, 4, 6","selected each even number"),t=_.filter([1,2,3,4,5,6],function(t){return 0==t%2}),equal(t.join(", "),"2, 4, 6",'aliased as "filter"')}),test("reject",function(){var t=_.reject([1,2,3,4,5,6],function(t){return 0==t%2});equal(t.join(", "),"1, 3, 5","rejected each even number");var e="obj",n=_.reject([1,2,3,4,5,6],function(t){return equal(e,"obj"),0!=t%2},e);equal(n.join(", "),"2, 4, 6","rejected each odd number")}),test("all",function(){ok(_.all([],_.identity),"the empty set"),ok(_.all([!0,!0,!0],_.identity),"all true values"),ok(!_.all([!0,!1,!0],_.identity),"one false value"),ok(_.all([0,10,28],function(t){return 0==t%2}),"even numbers"),ok(!_.all([0,11,28],function(t){return 0==t%2}),"an odd number"),ok(_.all([1],_.identity)===!0,"cast to boolean - true"),ok(_.all([0],_.identity)===!1,"cast to boolean - false"),ok(_.every([!0,!0,!0],_.identity),'aliased as "every"'),ok(!_.all([void 0,void 0,void 0],_.identity),"works with arrays of undefined")}),test("any",function(){var t=Array.prototype.some;Array.prototype.some=null,ok(!_.any([]),"the empty set"),ok(!_.any([!1,!1,!1]),"all false values"),ok(_.any([!1,!1,!0]),"one true value"),ok(_.any([null,0,"yes",!1]),"a string"),ok(!_.any([null,0,"",!1]),"falsy values"),ok(!_.any([1,11,29],function(t){return 0==t%2}),"all odd numbers"),ok(_.any([1,10,29],function(t){return 0==t%2}),"an even number"),ok(_.any([1],_.identity)===!0,"cast to boolean - true"),ok(_.any([0],_.identity)===!1,"cast to boolean - false"),ok(_.some([!1,!1,!0]),'aliased as "some"'),Array.prototype.some=t}),test("include",function(){ok(_.include([1,2,3],2),"two is in the array"),ok(!_.include([1,3,9],2),"two is not in the array"),ok(_.contains({moe:1,larry:3,curly:9},3)===!0,"_.include on objects checks their values"),ok(_([1,2,3]).include(2),"OO-style include")}),test("invoke",function(){var t=[[5,1,7],[3,2,1]],e=_.invoke(t,"sort");equal(e[0].join(", "),"1, 5, 7","first array sorted"),equal(e[1].join(", "),"1, 2, 3","second array sorted")}),test("invoke w/ function reference",function(){var t=[[5,1,7],[3,2,1]],e=_.invoke(t,Array.prototype.sort);equal(e[0].join(", "),"1, 5, 7","first array sorted"),equal(e[1].join(", "),"1, 2, 3","second array sorted")}),test("invoke when strings have a call method",function(){String.prototype.call=function(){return 42};var t=[[5,1,7],[3,2,1]],e="foo";equal(e.call(),42,"call function exists");var n=_.invoke(t,"sort");equal(n[0].join(", "),"1, 5, 7","first array sorted"),equal(n[1].join(", "),"1, 2, 3","second array sorted"),delete String.prototype.call,equal(e.call,void 0,"call function removed")}),test("pluck",function(){var t=[{name:"moe",age:30},{name:"curly",age:50}];equal(_.pluck(t,"name").join(", "),"moe, curly","pulls names out of objects")}),test("where",function(){var t=[{a:1,b:2},{a:2,b:2},{a:1,b:3},{a:1,b:4}],e=_.where(t,{a:1});equal(e.length,3),equal(e[e.length-1].b,4),e=_.where(t,{b:2}),equal(e.length,2),equal(e[0].a,1)}),test("findWhere",function(){var t=[{a:1,b:2},{a:2,b:2},{a:1,b:3},{a:1,b:4},{a:2,b:4}],e=_.findWhere(t,{a:1});deepEqual(e,{a:1,b:2}),e=_.findWhere(t,{b:4}),deepEqual(e,{a:1,b:4})}),test("max",function(){equal(3,_.max([1,2,3]),"can perform a regular Math.max");var t=_.max([1,2,3],function(t){return-t});equal(t,1,"can perform a computation-based max"),equal(-1/0,_.max({}),"Maximum value of an empty object"),equal(-1/0,_.max([]),"Maximum value of an empty array"),equal(_.max({a:"a"}),-1/0,"Maximum value of a non-numeric collection"),equal(299999,_.max(_.range(1,3e5)),"Maximum value of a too-big array")}),test("min",function(){equal(1,_.min([1,2,3]),"can perform a regular Math.min");var t=_.min([1,2,3],function(t){return-t});equal(t,3,"can perform a computation-based min"),equal(1/0,_.min({}),"Minimum value of an empty object"),equal(1/0,_.min([]),"Minimum value of an empty array"),equal(_.min({a:"a"}),1/0,"Minimum value of a non-numeric collection");var e=new Date(9999999999),n=new Date(0);equal(_.min([e,n]),n),equal(1,_.min(_.range(1,3e5)),"Minimum value of a too-big array")}),test("sortBy",function(){function t(t,e){this.x=t,this.y=e}var e=[{name:"curly",age:50},{name:"moe",age:30}];e=_.sortBy(e,function(t){return t.age}),equal(_.pluck(e,"name").join(", "),"moe, curly","stooges sorted by age");var n=[void 0,4,1,void 0,3,2];equal(_.sortBy(n,_.identity).join(","),"1,2,3,4,,","sortBy with undefined values");var n=["one","two","three","four","five"],r=_.sortBy(n,"length");equal(r.join(" "),"one two four five three","sorted by length");var i=[new t(1,1),new t(1,2),new t(1,3),new t(1,4),new t(1,5),new t(1,6),new t(2,1),new t(2,2),new t(2,3),new t(2,4),new t(2,5),new t(2,6),new t(void 0,1),new t(void 0,2),new t(void 0,3),new t(void 0,4),new t(void 0,5),new t(void 0,6)],o=_.sortBy(i,function(t){return t.x});deepEqual(o,i,"sortBy should be stable")}),test("groupBy",function(){var t=_.groupBy([1,2,3,4,5,6],function(t){return t%2});ok("0"in t&&"1"in t,"created a group for each value"),equal(t[0].join(", "),"2, 4, 6","put each even number in the right group");var e=["one","two","three","four","five","six","seven","eight","nine","ten"],n=_.groupBy(e,"length");equal(n["3"].join(" "),"one two six ten"),equal(n["4"].join(" "),"four five nine"),equal(n["5"].join(" "),"three seven eight");var r={};_.groupBy([{}],function(){ok(this===r)},r),n=_.groupBy([4.2,6.1,6.4],function(t){return Math.floor(t)>4?"hasOwnProperty":"constructor"}),equal(n.constructor.length,1),equal(n.hasOwnProperty.length,2);var i=[{}];_.groupBy(i,function(t,e,n){ok(n===i)});var i=[1,2,1,2,3],n=_.groupBy(i);equal(n["1"].length,2),equal(n["3"].length,1)}),test("countBy",function(){var t=_.countBy([1,2,3,4,5],function(t){return 0==t%2});equal(t["true"],2),equal(t["false"],3);var e=["one","two","three","four","five","six","seven","eight","nine","ten"],n=_.countBy(e,"length");equal(n["3"],4),equal(n["4"],3),equal(n["5"],3);var r={};_.countBy([{}],function(){ok(this===r)},r),n=_.countBy([4.2,6.1,6.4],function(t){return Math.floor(t)>4?"hasOwnProperty":"constructor"}),equal(n.constructor,1),equal(n.hasOwnProperty,2);var i=[{}];_.countBy(i,function(t,e,n){ok(n===i)});var i=[1,2,1,2,3],n=_.countBy(i);equal(n["1"],2),equal(n["3"],1)}),test("sortedIndex",function(){var t=[10,20,30,40,50],e=35,n=_.sortedIndex(t,e);equal(n,3,"35 should be inserted at index 3");var r=_.sortedIndex(t,30);equal(r,2,"30 should be inserted at index 2");var i=[{x:10},{x:20},{x:30},{x:40}],o=function(t){return t.x};strictEqual(_.sortedIndex(i,{x:25},o),2),strictEqual(_.sortedIndex(i,{x:35},"x"),3);var a={1:2,2:3,3:4};o=function(t){return this[t]},strictEqual(_.sortedIndex([1,3],2,o,a),1)}),test("shuffle",function(){var t=_.range(10),e=_.shuffle(t).sort();notStrictEqual(t,e,"original object is unmodified"),equal(e.join(","),t.join(","),"contains the same members before and after shuffle")}),test("toArray",function(){ok(!_.isArray(arguments),"arguments object is not an array"),ok(_.isArray(_.toArray(arguments)),"arguments object converted into array");var t=[1,2,3];ok(_.toArray(t)!==t,"array is cloned"),equal(_.toArray(t).join(", "),"1, 2, 3","cloned array contains same elements");var e=_.toArray({one:1,two:2,three:3});equal(e.join(", "),"1, 2, 3","object flattened into array");try{var n=_.toArray(document.childNodes)}catch(r){}ok(_.isArray(n),"should not throw converting a node list")}),test("size",function(){equal(_.size({one:1,two:2,three:3}),3,"can compute the size of an object"),equal(_.size([1,2,3]),3,"can compute the size of an array");var t=function(){return _.size(arguments)};equal(t(1,2,3,4),4,"can test the size of the arguments object"),equal(_.size("hello"),5,"can compute the size of a string"),equal(_.size(null),0,"handles nulls")})});