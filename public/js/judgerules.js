(function(){define(["util","judge","team","club"],function(a,b,c,d){var e;return e=function(){function e(a,b){var c,d,e;this.tournament=a,b==null&&(b=[]),b.criteria!=null&&(b=b.criteria),this.criteria=b;for(d=0,e=b.length;d<e;d++)c=b[d],this.unpackCriterion(c)}return e.prototype.newCriteria=function(a,b,c){return{judge:a,verb:b,team:c,toJSON:this.criterionPackFn()}},e.prototype.criterionPackFn=function(){var e;return e=this.tournament,function(){var f;return f={verb:this.verb},this.judge===null&&(f.judge=f.judgeType=-1),typeof this.judge=="number"?(f.judge=this.judge,f.judgeType=0):this.judge instanceof b?(f.judge=a.packCycle(this.judge,e.judges),f.judgeType=1):this.judge instanceof d&&(f.judge=a.packCycle(this.judge,e.clubs),f.judgeType=2),this.team===null&&(f.team=f.teamType=-1),typeof this.team=="number"?(f.team=this.team,f.teamType=0):this.team instanceof c?(f.team=a.packCycle(this.team,e.teams),f.teamType=1):this.team instanceof d&&(f.team=a.packCycle(this.team,e.clubs),f.teamType=2),f}},e.prototype.unpackCriterion=function(b){var c;c=this.tournament,b.judgeType===-1?b.judge=null:b.judgeType===1?b.judge=a.unpackCycle(b.judge,c.judges):b.judgeType===2&&(b.judge=a.unpackCycle(b.judge,c.clubs)),delete b.judgeType,b.teamType===-1?b.team=null:b.teamType===1?b.team=a.unpackCycle(b.team,c.teams):b.teamType===2&&(b.team=a.unpackCycle(b.team,c.clubs)),delete b.teamType,b.toJSON=this.criterionPackFn()},e.judgeLabel=function(a){return a===0?"All judges":a===1?"Unaffiliated judges":a instanceof d?"Judges from "+a.name:a instanceof b?a.name:"!!ERROR!!"},e.teamLabel=function(a){return a===0?"any team":a===1?"teams from their club":a===2?"when both teams are from their club":a instanceof d?"teams from "+a.name:a instanceof c?a.name:"!!ERROR!!"},e.verbLabel=["can judge","can't judge"],e.verbResult=[!0,!1],e.prototype.judgeArray=function(){return[0,1].concat(this.tournament.clubs,this.tournament.judges)},e.prototype.teamArray=function(){return[0,1,2].concat(this.tournament.clubs,this.tournament.teams)},e.prototype.evalCriterion=function(a,e,f){var g,h,i,j;return h=f.teams[0],i=f.teams[1],h==null||i==null||e==null?2:a.team==null||a.judge==null?2:a.judge===1&&e.club!=null?2:a.judge instanceof d&&e.club!==a.judge?2:a.judge instanceof b&&e!==a.judge?2:(j=a.verb===0?!0:!1,g=function(b){return a.team===0?!0:a.team===1&&e.club!=null&&e.club===b.club?!0:a.team===2&&e.club!=null&&h.club===i.club&&h.club===e.club?!0:a.team instanceof d&&b.club===a.team?!0:a.team instanceof c&&b===a.team?!0:!1},a.team===2&&e.club!=null&&h.club===i.club&&h.club===e.club?j:g(h)||g(i)?j:2)},e.prototype.isCompatible=function(a,b,c){var d,e,f,g,h;h=this.criteria;for(f=0,g=h.length;f<g;f++){d=h[f],e=this.evalCriterion(d,a,b);if(e===!0||e===!1)return e}return c!=null?c.isCompatible(a,b,null):!0},e.prototype.compatibilityFactor=function(a,b,c){var d,e,f,g,h,i;f=0,i=this.criteria;for(g=0,h=i.length;g<h;g++){d=i[g],e=this.evalCriterion(d,a,b),e===!1&&f++;if(e===!0)return f}return c!=null?f+c.compatibilityFactor(a,b,null):f},e.prototype.toJSON=function(){return{criteria:this.criteria}},e.mainRules=function(a,b){return new e(a,b!=null?b:[{judge:0,verb:0,team:2},{judge:0,verb:1,team:1}])},e.prototype.addNewRule=function(){return this.criteria.unshift(this.newCriteria(0,0,0))},e.prototype.removeRule=function(a){return this.criteria.splice(a,1)},e.prototype.entityDestroyed=function(a){var b,c,d,e,f;if(a==null)return;e=this.criteria,f=[];for(c=0,d=e.length;c<d;c++)b=e[c],b.judge===a&&(b.judge=null),b.team===a?f.push(b.team=null):f.push(void 0);return f},e}()})}).call(this)