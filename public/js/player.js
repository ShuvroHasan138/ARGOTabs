(function(){define(["util"],function(e){var t;return t=function(){function t(e,t){var n,r;if(this.tournament=e,t)for(n in t)r=t[n],this[n]=r;null==this.name&&(this.name="Unnamed")}return t.prototype.unpackCycles=function(){return this.team=e.unpackCycle(this.team,this.tournament.teams)},t.prototype.toJSON=function(){var t;return t=e.copyObject(this,["tournament","stats"]),t.team=e.packCycle(this.team,this.tournament.teams),t},t.prototype.destroy=function(){return this.team?this.team.removePlayer(this):void 0},t.calculateStats=function(e,t){var n,r,o,i;for(i=[],r=0,o=e.length;o>r;r++)n=e[r],i.push(n.stats=n.getStats(t));return i},t.prototype.getStats=function(e){var t,n,r,o,i,a,s,l,u,d,c,f,p,h,m,v,g,b;for(r={rawScore:0,rawReply:0,rawHighLow:0,roundsPlayed:0,roundsReplyed:0,scoreCount:0,replyCount:0,byes:0,replyByes:0,minScore:80,maxScore:0,score:0,reply:0,ballots:0,replyBallots:0,scoreHighLow:0},d=0,h=e.length;h>d;d++)if(i=e[d],"object"==typeof i&&(i=i.id),o=this.tournament.roundWithId(i),null!=this.team&&(t=this.team.rounds[i].ballot,t.locked&&null!=t.roles)){if(this.team===t.teams[0])s=0;else{if(this.team!==t.teams[1])continue;s=1}for(l=-1,n=c=0;4>c;n=++c)if(t.roles[s][n]===this){l=n;break}if(-1!==l&&t.presence[s])if(t.presence[1-s]&&t.teams[1-s])if(3!==l)for(r.roundsPlayed++,g=t.votes,f=0,m=g.length;m>f;f++)u=g[f],a=u.scores[s][l],r.rawScore+=a*u.ballots,r.scoreCount+=u.ballots,a<r.minScore&&(r.minScore=a),a>r.maxScore&&(r.maxScore=a);else for(r.roundsReplyed++,b=t.votes,p=0,v=b.length;v>p;p++)u=b[p],a=u.scores[s][3],r.rawReply+=a*u.ballots,r.replyCount+=u.ballots;else 3!==l?(r.byes+=o.ballotsPerMatchSolved(),r.roundsPlayed++):(r.replyByes+=o.ballotsPerMatchSolved(),r.roundsReplyed++)}return r.ballots=r.scoreCount+r.byes,r.replyBallots=r.replyCount+r.replyByes,r.score=r.scoreCount?r.rawScore/r.scoreCount:r.byes?-1:0,r.reply=r.replyCount?r.rawReply/r.replyCount:r.replyByes?-1:0,r.scoreHighLow=r.ballots>2?r.scoreCount?(r.rawScore+r.score*r.byes-r.minScore-r.maxScore)/(r.ballots-2):-1:0,r.wins=r.rawWins+r.byeWins,r.ballots=r.rawBallots+r.byeBallots,r},t}()})}).call(this);