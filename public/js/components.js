(function(){define(["jquery","util","judgerules","jquery.transit","underscore","templates","angular","jquery.event.drag","html2canvas"],function(a,b,c){var d;return d=angular.module("components",[]),d.directive("navLi",function(){return{restrict:"E",scope:{href:"@"},transclude:!0,replace:!0,controller:["$scope","$location",function(a,b){return a.$watch(function(){return b.path()},function(b,c){return a["class"]=b===a.href?"active":""})}],template:templates.navLi()}}),d.directive("sorterCriteria",[function(){return{template:templates.sorterCriteria(),restrict:"E",scope:{model:"=bind",onUpdate:"&onUpdate"},link:function(a,c,d){return a.manualMove=function(c,e){e!==c&&b.safeApply(a,function(){var b;return b=a.model.criteria.splice(c,1)[0],a.model.criteria.splice(e,0,b)});if(d.onUpdate!=null)return a.onUpdate()}}}}]),d.directive("judgeRules",function(){return{template:templates.judgeRules(),restrict:"E",replace:!0,scope:{model:"="},controller:["$scope","$element",function(a,d){return a.verbs=[0,1],a.verbNames=c.verbLabel,a.buildJudgeList=function(){var b,d,e,f,g,h,i,j;e=a.model,f=a.judgeNames=[],d=a.judgeIndexes=[],j=a.judgeList=a.model.judgeArray();for(b=h=0,i=j.length;h<i;b=++h)g=j[b],f.push(c.judgeLabel(g)),d.push(b)},a.buildTeamList=function(){var b,d,e,f,g,h,i,j;e=a.model,f=a.teamNames=[],d=a.teamIndexes=[],j=a.teamList=a.model.teamArray();for(b=h=0,i=j.length;h<i;b=++h)g=j[b],f.push(c.teamLabel(g)),d.push(b)},a.buildJudgeList(),a.buildTeamList(),a.addRule=function(){return a.model.addNewRule(),setTimeout(function(){var a;if(a=b.focusableElement(d.find(".judge-rule:first-child")))return a.focus()},1)},a.removeRule=function(b){return a.model.removeRule(b)},this.scope=a,this}]}}),d.directive("judgeRulesHelper",function(){return{require:"^judgeRules",link:function(a,b,c,d){var e;return e=d.scope,a.$watch("vlo.judge",function(b){var c,d,f,g,h;try{if(e.judgeList[a.judgeIndex]===b)return}catch(i){}h=e.judgeList;for(c=f=0,g=h.length;f<g;c=++f){d=h[c];if(d===b){a.judgeIndex=c;return}}}),a.$watch("judgeIndex",function(b){try{a.vlo.judge=e.judgeList[b]}catch(c){}}),a.$watch("vlo.team",function(b){var c,d,f,g,h;try{if(e.teamList[a.teamIndex]===b)return}catch(i){}h=e.teamList;for(c=f=0,g=h.length;f<g;c=++f){d=h[c];if(d===b){a.teamIndex=c;return}}}),a.$watch("teamIndex",function(b){try{a.vlo.team=e.teamList[b]}catch(c){}})}}}),d.directive("tristateCheckbox",["$parse",function(a){return{link:function(b,c,d){return b.$watch(function(){return a(d.tristateCheckbox)(b)},function(a){return a===null?(c.prop("indeterminate",!0),c.prop("checked",!0)):(c.prop("indeterminate",!1),c.prop("checked",a))}),c.bind("change",function(){var e,f,g;return g=a(d.tristateCheckbox),f=c.prop("indeterminate"),e=c.prop("checked"),!f&&!e&&g(b)&&(c.prop("indeterminate",f=!0),c.prop("checked",e=!0)),b.$apply(function(){return f?g.assign(b,null):g.assign(b,e)})})}}}]),d.directive("textEditCell",["$parse",function(a){return{template:templates.textEditCell(),restrict:"E",scope:{extra:"@",minWidth:"@inputWidth",pattern:"@pattern",validator:"&",softValidator:"&",getter:"&",setter:"&",valid:"="},replace:!0,transclude:!0,link:function(c,d,e){var f,g,h,i;c.editing=!1,i=d.find(".textedit-label"),h=d.find("input"),c.$watch(function(){return e.softValidator==null?!0:c.softValidator({o:a(e.bind)(c.$parent)})},function(a){return e.valid!=null&&(c.valid=a),a?(c.labelClass="valid",c.inputClass=""):(c.labelClass="invalid",c.inputClass="error")}),c.$watch(function(){return a(e.bind)(c.$parent)},function(a){return e.getter!=null?c.valueParsed=c.getter({o:a}):c.valueParsed=a}),c.$watch("valueParsed",function(b,d){var f;return f=e.setter!=null?c.setter({o:b}):b,c.pattern&&typeof b=="string"&&!b.match(new RegExp("^"+c.pattern+"$"))||e.validator!=null&&!c.validator({o:f})?c.valueParsed=d:a(e.bind).assign(c.$parent,f)}),c.$watch(function(){return e.editing},function(a,b){if(a!=null){if(a&&!b)return c.beginEdit();if(!a&&b)return c.endEdit()}}),c.$watch(function(){return e.enabled==null||c.$parent.$eval(e.enabled)},function(a,b){return c._enabled=a,a?i[0].tabIndex=0:i[0].removeAttribute("tabIndex")}),c.beginEdit_=function(){if(e.editing==null&&c._enabled)return c.beginEdit()},g=function(){return b.safeApply(c,c.beginEdit_)},f=function(){return b.safeApply(c,function(){if(e.editing==null)return c.endEdit()})},i.focus(g),d.parent()[0].tagName==="TD"&&d.parent().click(g),h.blur(f),h.keypress(function(a){if(a.which===13)return f()}),c.beginEdit=function(){var a,b;if(c.editing)return;return c.editing=!0,a=parseInt(c.minWidth),isNaN(a)&&(a=100),b=i.outerWidth(),a>b&&(b=a),h.css("width",b),setTimeout(function(){return h.focus(),h.select()},0)},c.endEdit=function(){return c.editing=!1};if(e.editing)return c.beginEdit()}}}]),d.directive("multiCell",function(){return{template:templates.multiCell(),restrict:"E",scope:{value:"=bind",choiceName:"&choiceName",choices:"=choices",allowNil:"@nilPlaceholder",minWidth:"@inputWidth",onBeginEdit:"&",onEndEdit:"&"},replace:!0,transclude:!0,compile:function(a,c,d){return(!c.nilPlaceholder||c.hideNil)&&a.find("option").remove(),function(a,c,d){var e,f,g;return a.editing=!1,g=c.find("select"),f=c.find(".multi-label"),e=function(){return b.safeApply(a,function(){return a.beginEdit()})},f.focus(e),c.parent()[0].tagName==="TD"&&c.parent().click(e),g.blur(function(){return b.safeApply(a,function(){return a.endEdit()})}),a.beginEdit=function(){var b,c;if(a.editing||!a._enabled)return;return a.onBeginEdit(),a.editing=!0,b=parseInt(a.minWidth),isNaN(b)&&(b=100),c=f.outerWidth(),b>c&&(c=b),g.css("width",c),setTimeout(function(){return g.focus()},0)},a.endEdit=function(){return a.editing=!1,a.onEndEdit()},a.$watch(function(){return d.enabled==null||a.$parent.$eval(d.enabled)},function(b,c){return a._enabled=b,b?f[0].tabIndex=0:f[0].removeAttribute("tabIndex")}),a.getChoiceName=function(b){return b!=null?a.choiceName({o:b}):a.allowNil}}}}}),d.directive("vlistCell",function(){return{template:templates.vlistCell(),restrict:"E",scope:{model:"=bind",manualMove:"&manualMove"},transclude:!0,replace:!0,controller:["$scope","$element","$attrs","$transclude","$parse",function(c,d,e,f,g){var h,i,j,k,l,m,n,o,p,q,r,s,t,u;return this.transclude=f,i=null,h=-1,p=-1,m=null,o=null,q=null,j=0,k=0,l=-1,u=0,n=0,d.on("draginit",function(b){var c,e,f;return e=a(b.target),i=null,m=null,e.hasClass("moveable-true")?m=e:(c=e.parents(".moveable-true")).length&&(m=c),m?(o=d.find(".item"),l=a.makeArray(o).indexOf(m[0]),i=m.find(".vlist-content"),f=i.offset(),j=b.pageX-f.left,k=b.pageY-f.top,d):!1}),s=function(b){var c,d,e,f,g,i,j;c=-1;for(e=i=0,j=o.length;i<j;e=++i){g=o[e];if(e===l)continue;d=a(g),f=d.offset();if(f.left<=b.pageX&&b.pageX<=f.left+d.outerWidth()&&f.top<=b.pageY&&b.pageY<=f.top+d.outerHeight()){c=e;break}}return c!==p&&c>=0&&(h>=l&&h++,h<=c?h=c+1:h=c,h>l&&h--),p=c},r=function(){},t=function(b){var c,d,e,f,g,m,p,r;i.css("left",b.pageX-j),i.css("top",b.pageY-k),f=h,s(b);if(h!==f){g=0,d=0,r=[];for(e=m=0,p=o.length;m<p;e=++m){c=o[e];if(e===l)continue;d===h&&(g+=n),d++,a(c).transition({top:g,duration:100}),r.push(g+=q[e].h)}return r}},d.on("dragstart",function(b){var c,e,f,g,j,k,m,p,r;c=d,c.css("width",c.width()),c.css("height",c.height()),q=[];for(f=k=0,p=o.length;k<p;f=++k)j=o[f],e=a(j),g=e.position(),g.w=e.width(),g.h=e.height(),q.push(g);for(f=m=0,r=o.length;m<r;f=++m)j=o[f],e=a(j),g=q[f],e.css("width",g.w),e.css("height",g.h),e.css("top",g.top),e.css("left",g.left),e.css("position","absolute");return h=l,u=i.width(),n=i.height(),i.css("width",u),i.css("height",n),i.css("position","absolute"),a("body").append(i),t(b),i}),d.on("drag",{distance:2},function(a){t(a)}),d.on("dragend",function(f){var g,j,k,n,p,q;for(k=p=0,q=o.length;p<q;k=++p)n=o[k],j=a(n),j.css("width",""),j.css("height",""),j.css("top",""),j.css("left",""),j.css("position","");m.append(i),i.css("width",""),i.css("height",""),i.css("position",""),g=d.find(".vlist"),g.css("width",""),g.css("height",""),e.manualMove!=null?b.safeApply(c,function(){return c.manualMove({from:l,to:h})}):h!==l&&b.safeApply(c,function(){return j=c.model.splice(l,1)[0],c.model.splice(h,0,j)})}),this}]}}),d.directive("vlistCellTransclude",function(){return{require:"^vlistCell",link:function(a,b,c,d){return d.transclude(function(c,d){return d.vlo=a.vlo,d.$on("$destroy",a.$watch("$index",function(a){return d.$index=a})),b.append(c)})}}}),d.directive("hlistCellTransclude",function(){return{require:"^hlistCell",link:function(a,b,c,d){return d.transclude(function(c,d){return d.hlo=a.hlo,d.$on("$destroy",a.$watch("$index",function(a){return d.$index=a})),b.append(c)})}}}),d.directive("hlistCell",function(){return{template:templates.hlistCell(),restrict:"E",scope:{model:"=bind",addItem:"&addItem",_addItemHidden:"&addItemHidden",removeItem:"&removeItem",_removeItemHidden:"&removeItemHidden",editHidden:"=editHidden",separator:"@separator",reorders:"&reorders",reordersAlways:"@reordersAlways",userdata:"&userdata",dropGroup:"@dropGroup",groupTest:"&groupTest",groupReplaceTest:"&groupReplaceTest",canDrop:"&canDrop",canReplace:"&canReplace",manualReplace:"&manualReplace",manualMove:"&manualMove",dragStartFn:"&onStartDrag",dragEndFn:"&onEndDrag",replaceClass:"@",extensionElement:"@",extensionElementLast:"@"},transclude:!0,controller:["$scope","$element","$attrs","$parse","$transclude",function(c,d,e,f,g){var h,i,j,k,l,m,n,o,p,q,r;return this.transclude=g,c.edit=!1,c.remove=function(a){c.removeItem({index:a});if(!c.model.length)return c.edit=!1},c.add=function(){return c.addItem(),setTimeout(function(){var a;if(a=b.focusableElement(d.find(".item"),!1))return a.focus()},1)},c.comma=function(a){return a?",":""},c.$watch(function(){return e.dropGroup!=null},function(a){return c.hasGroup=a}),c.$watch(function(){return e.addItem!=null&&(e.addItemHidden==null||!c._addItemHidden())},function(a){return c.canAddItem=a}),c.$watch(function(){return e.reorders!=null&&c.reorders(c.$parent)},function(a){return c._reorders=a}),c.removeItemHidden=function(a,b){return e.removeItemHidden!=null?c._removeItemHidden({hlo:a,$index:b}):!1},k=null,l=null,h=null,i=null,m=n=0,o=null,q=[],j=function(){var b,f,g,h,i,j,k,l,m,n,o,p,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F;x=q=[],u=function(a){return{ud:a.userdata(),model:a.model}},c.fromInstance=i=u(c),e.dropGroup==null?t=[d[0]]:t=a("hlist-cell"),F=[];for(z=0,C=t.length;z<C;z++){s=t[z],y=a(s).isolateScope(),l=y===c?i:u(y);if(e.dropGroup!=null&&y.dropGroup!==c.dropGroup)continue;w={fromList:i,toList:l},g=e.groupTest==null||c.groupTest(w),h=e.groupReplaceTest!=null?c.groupReplaceTest(w):e.canReplace!=null,k=x.length,n=a(s).find(".item"),g&&!n.length&&n.push(a(s).find(".placeholder")[0]);if(g||h)for(j=A=0,D=n.length;A<D;j=++A)m=n[j],b=a(m),v=b.offset(),x.push({top:v.top,left:v.left,width:b.outerWidth(),height:b.outerHeight(),index:j,replace:h,elem:h?b:null,move:g,instance:l});if(g){k=x[k],p=x.length-1,o=x[p],a(n[0]).hasClass("placeholder")&&(k.empty=!0,k.replace=!1);if(y.extensionElement!=null&&y.extensionElement!==""){f=a(y.extensionElement);for(B=0,E=f.length;B<E;B++)m=f[B],b=a(m),v=b.offset(),x.push({top:v.top,left:v.left,width:b.outerWidth(),height:b.outerHeight(),lineTop:k.top,lineLeft:k.left,lineHeight:k.height,empty:!0,move:!0,index:0,instance:l})}y.extensionElementLast!=null&&y.extensionElementLast!==""?(f=a(y.extensionElementLast),F.push(function(){var c,d,e;e=[];for(c=0,d=f.length;c<d;c++)m=f[c],b=a(m),v=b.offset(),r=o.empty?o.left:o.left+o.width,e.push(x.push({top:v.top,left:v.left,width:b.outerWidth(),height:b.outerHeight(),lineTop:o.top,lineLeft:r,lineHeight:o.height,empty:!0,move:!0,index:p,instance:l}));return e}())):F.push(void 0)}else F.push(void 0)}return F},p=function(a,b){var c,d,e,f,g,h,i,j;for(i=0,j=q.length;i<j;i++){f=q[i],h=f.width,c=f.height,g=f.top,d=f.left;if(b<g||b>g+c||a<d||a>d+h)continue;return e={x:d,y:g,height:c,width:h,replace:f.replace,index:f.index,instance:f.instance,elem:f.elem},f.replace&&f.move&&(a<d+h*(1/3)&&(e.replace=!1),a>d+h*(2/3)&&(e.replace=!1,e.x+=h,e.index++)),!f.replace&&f.move&&!f.empty&&a>d+h*.5&&(e.x+=h,e.index++),f.lineTop!=null&&(e.y=f.lineTop),f.lineLeft!=null&&(e.x=f.lineLeft),f.lineHeight!=null&&(e.height=f.lineHeight),e}return null},r=function(a){var b,d,f,g;h&&(h.css("left",a.pageX-m),h.css("top",a.pageY-n));if(i)return f=p(a.pageX,a.pageY),f&&f.instance===c.fromInstance&&(f.index===o||!f.replace&&f.index===o+1)&&(f=null),g=e.replaceClass!=null,d=k!=null&&(!g||!k.replace),b=f!=null&&(!g||!f.replace),g&&(k!=null&&k.replace&&k.elem.removeClass(c.replaceClass),f!=null&&f.replace&&(console.log(f),f.elem.addClass(c.replaceClass))),d&&!b?i.css("display","none"):b&&!d&&i.css("display","block"),f&&b&&(i.css("left",f.x+"px"),i.css("top",f.y+"px"),i.css("height",f.height+"px"),i.css("width",f.replace?f.width:0),i.css("opacity",f.replace?.5:1)),k=f},d.on("draginit",function(b){var c,e;return e=a(b.target),l=null,e.hasClass("moveable-true")?l=e:(c=e.parents(".moveable-true")).length&&(l=c),l?d:!1}),d.on("dragstart",function(d){var e,f;return o=l.index(),e=window.pageXOffset,f=window.pageYOffset,j(),html2canvas(l[0],{scale:window.devicePixelRatio?window.devicePixelRatio:1,onrendered:function(b){var c,g,j,k;window.scrollTo(e,f),g=l.outerWidth(),c=l.outerHeight(),k={x:b.width/g,y:b.height/c},h=a(b),h.css("width",g),h.css("height",c),h.css("position","absolute"),h.css("opacity","0.6"),j=l.offset(),m=d.pageX-j.left,n=d.pageY-j.top,l.css("opacity","0.4"),i=a(document.createElement("div")),i.css("position","absolute"),i.css("border","1px solid #0088cc"),i.css("background-color","#0088cc"),i.css("border-radius","1px"),i.css("width","0px"),i.css("height","0px"),i.css("display","none"),a(document.body).append(i),a(document.body).append(h),r(d)}}),b.safeApply(c,function(){return c.dragStartFn({list:c.fromInstance,index:o})}),l}),d.on("drag",{distance:2},function(a){r(a)}),d.on("dragend",function(a){var d,f;h&&(h.remove(),h=null),l.css("opacity","1"),i&&(i.remove(),i=null),k&&(k.replace?e.manualReplace!=null?b.safeApply(c,function(){return c.manualReplace({fromList:c.fromInstance,toList:k.instance,fromIndex:o,toIndex:k.index})}):(k.instance!==c.fromInstance||o!==k.index)&&b.safeApply(c,function(){var a,b;return a=c.model[o],b=k.instance.model[k.index],c.model[o]=b,k.instance.model[k.index]=a}):e.manualMove!=null?b.safeApply(c,function(){return c.manualMove({fromList:c.fromInstance,toList:k.instance,fromIndex:o,toIndex:k.index})}):(d=k.index,f=k.instance===c.fromInstance,f&&d>o&&d--,(!f||d!==o)&&b.safeApply(c,function(){var a;return a=c.model.splice(o,1)[0],k.instance.model.splice(d,0,a)}))),b.safeApply(c,function(){return c.dragEndFn({list:c.fromInstance,index:o})}),q=[],k=null}),this}]}})})}).call(this)