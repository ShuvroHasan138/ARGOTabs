(function(){define(["util","underscore"],function(a){var b;return b=function(){function b(a,b){var c,d;this.round=a;if(b)for(c in b)d=b[c],this[c]=d;this.teams==null&&(this.teams=[null,null]),this.presence==null&&(this.presence=[!0,!0]),this.room==null&&(this.room=null),this.locked==null&&(this.locked=!1),this.votes==null&&(this.votes=[]),this.judges==null&&(this.judges=[]),this.shadows==null&&(this.shadows=[]),this.roles==null&&(this.roles=null)}return b.prototype.getSpeakerRoles=function(){var a,b,c,d,e,f,g=this;d=[{roles:[]},{roles:[]}];if(this.roles){for(a=e=0;e<=1;a=++e)for(b=f=0;f<=3;b=++f)d[a].roles.push(this.roles[a][b]);return d}return c=function(b,c){var d,e,f,h,j,k,l,m,n,o,p;k=g.round.previousRounds();for(l=k.length-1;l>=0;l+=-1){h=k[l],d=b.rounds[h.id];if(d!=null){d=d.ballot;if(d!=null){j=0,d.teams[1]===b&&(j=1);if(d.roles==null)continue;k=d.roles[j];if(k==null)continue;for(m=0,n=k.length;m<n;m++)a=k[m],c.push(a);return}}}f=b.players.length;if(f){for(e=o=0;o<=2;e=++o)c.push(b.players[e%f]);c.push(b.players[0])}else for(e=p=0;p<=3;e=++p)c.push(null)},c(this.teams[0],d[0].roles),c(this.teams[1],d[1].roles),d},b.prototype.isCompatible=function(a){return!1},b.prototype.getVotesForBallots=function(b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p;if(this.votes&&this.votes.length){j=[],p=this.votes;for(k=0,o=p.length;k<o;k++)i=p[k],j.push(a.deepCopy(i,["judge"]));return j}e=this.judges,g=e.length,j=[],h=function(a,b){return b==null&&(b=1),i={},i.judge=a,i.ballots=b,i.prop=b,i.opp=0,i.scores=[[70,70,70,35],[70,70,70,35]],i};if(g)if(g>=b)for(d=l=0;0<=b?l<b:l>b;d=0<=b?++l:--l)j.push(h(e[d]));else{c=b/g|0,f=b%g;for(d=m=0;0<=g?m<g:m>g;d=0<=g?++m:--m)j.push(h(e[d],c+(d<f?1:0)))}else for(d=n=0;0<=b?n<b:n>b;d=0<=b?++n:--n)j.push(h(null));return j},b.prototype.unpackCycles=function(){var b,c,d,e,f,g,h,i,j,k,l;this.teams[0]=a.unpackCycle(this.teams[0],this.round.tournament.teams),this.teams[1]=a.unpackCycle(this.teams[1],this.round.tournament.teams),this.room=a.unpackCycle(this.room,this.round.tournament.rooms),a.unpackCycles(this.judges,this.round.tournament.judges),a.unpackCycles(this.shadows,this.round.tournament.judges);if(this.roles!=null)for(b=f=0;f<=1;b=++f){if(this.teams[b]==null)continue;d=this.roles[b];for(c=g=0,j=d.length;0<=j?g<j:g>j;c=0<=j?++g:--g)d[c]=a.unpackCycle(d[c],this.teams[b].players)}k=this.votes,l=[];for(h=0,i=k.length;h<i;h++)e=k[h],l.push(e.judge=a.unpackCycle(e.judge,this.round.tournament.judges));return l},b.prototype.toJSON=function(){var b,c,d,e,f,g,h,i,j,k,l,m;c=a.copyObject(this,["round","stats"]),c.teams=[a.packCycle(this.teams[0],this.round.tournament.teams),a.packCycle(this.teams[1],this.round.tournament.teams)];if(this.roles!=null){c.roles=[[],[]];for(b=h=0;h<=1;b=++h){if(this.teams[b]==null)continue;e=c.roles[b],g=this.roles[b];for(i=0,k=g.length;i<k;i++)d=g[i],e.push(a.packCycle(d,this.teams[b].players))}}c.votes=[],m=this.votes;for(j=0,l=m.length;j<l;j++)e=m[j],f=a.copyObject(e),f.judge=a.packCycle(f.judge,this.round.tournament.judges),c.votes.push(f);return c.room=a.packCycle(this.room,this.round.tournament.rooms),c.judges=a.packCycles(this.judges,this.round.tournament.judges),c.shadows=a.packCycles(this.shadows,this.round.tournament.judges),c},b.prototype.destroy=function(){if(this.team)return this.team.removePlayer(this)},b}()})}).call(this)