(function(){define(["util","underscore"],function(t){var e;return e=function(){function e(t,e){var n,s;if(this.round=t,e)for(n in e)s=e[n],this[n]=s;null==this.teams&&(this.teams=[null,null]),null==this.presence&&(this.presence=[!0,!0]),null==this.room&&(this.room=null),null==this.locked&&(this.locked=!1),null==this.votes&&(this.votes=[]),null==this.judges&&(this.judges=[]),null==this.shadows&&(this.shadows=[]),null==this.roles&&(this.roles=null)}return e.prototype.getSpeakerRoles=function(){var t,e,n,s,o,r;if(s=[{roles:[]},{roles:[]}],this.roles){for(t=o=0;1>=o;t=++o)for(e=r=0;3>=r;e=++r)s[t].roles.push(this.roles[t][e]);return s}return n=function(t,e){var n,s,o,r,l;if(s=t.players.length){for(n=o=0;2>=o;n=++o)e.push(t.players[n%s]);return e.push(t.players[0])}for(l=[],n=r=0;3>=r;n=++r)l.push(e.push(null));return l},n(this.teams[0],s[0].roles),n(this.teams[1],s[1].roles),s},e.prototype.isCompatible=function(t){return!1},e.prototype.getVotesForBallots=function(e){var n,s,o,r,l,i,u,a,h,c,d,p,m,f;if(this.votes&&this.votes.length){for(a=[],f=this.votes,h=0,m=f.length;m>h;h++)u=f[h],a.push(t.deepCopy(u,["judge"]));return a}if(o=this.judges,l=o.length,a=[],i=function(t,e){return null==e&&(e=1),u={},u.judge=t,u.ballots=e,u.prop=e,u.opp=0,u.scores=[[70,70,70,35],[70,70,70,35]],u},l)if(l>=e)for(s=c=0;e>=0?e>c:c>e;s=e>=0?++c:--c)a.push(i(o[s]));else for(n=0|e/l,r=e%l,s=d=0;l>=0?l>d:d>l;s=l>=0?++d:--d)a.push(i(o[s],n+(r>s?1:0)));else for(s=p=0;e>=0?e>p:p>e;s=e>=0?++p:--p)a.push(i(null));return a},e.prototype.unpackCycles=function(){var e,n,s,o,r,l,i,u,a,h,c;if(this.teams[0]=t.unpackCycle(this.teams[0],this.round.tournament.teams),this.teams[1]=t.unpackCycle(this.teams[1],this.round.tournament.teams),this.room=t.unpackCycle(this.room,this.round.tournament.rooms),t.unpackCycles(this.judges,this.round.tournament.judges),t.unpackCycles(this.shadows,this.round.tournament.judges),null!=this.roles)for(e=r=0;1>=r;e=++r)if(null!=this.teams[e])for(s=this.roles[e],n=l=0,a=s.length;a>=0?a>l:l>a;n=a>=0?++l:--l)s[n]=t.unpackCycle(s[n],this.teams[e].players);for(h=this.votes,c=[],i=0,u=h.length;u>i;i++)o=h[i],c.push(o.judge=t.unpackCycle(o.judge,this.round.tournament.judges));return c},e.prototype.toJSON=function(){var e,n,s,o,r,l,i,u,a,h,c,d;if(n=t.copyObject(this,["round","stats"]),n.teams=[t.packCycle(this.teams[0],this.round.tournament.teams),t.packCycle(this.teams[1],this.round.tournament.teams)],null!=this.roles)for(n.roles=[[],[]],e=i=0;1>=i;e=++i)if(null!=this.teams[e])for(o=n.roles[e],l=this.roles[e],u=0,h=l.length;h>u;u++)s=l[u],o.push(t.packCycle(s,this.teams[e].players));for(n.votes=[],d=this.votes,a=0,c=d.length;c>a;a++)o=d[a],r=t.copyObject(o),r.judge=t.packCycle(r.judge,this.round.tournament.judges),n.votes.push(r);return n.room=t.packCycle(this.room,this.round.tournament.rooms),n.judges=t.packCycles(this.judges,this.round.tournament.judges),n.shadows=t.packCycles(this.shadows,this.round.tournament.judges),n},e.prototype.destroy=function(){return this.team?this.team.removePlayer(this):void 0},e}()})}).call(this);