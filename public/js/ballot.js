(function(){define(["util","underscore"],function(t){var n;return n=function(){function n(t,n){var s,e;if(this.round=t,n)for(s in n)e=n[s],this[s]=e;null==this.teams&&(this.teams=[null,null]),null==this.presence&&(this.presence=[!0,!0]),null==this.room&&(this.room=null),null==this.locked&&(this.locked=!1),null==this.votes&&(this.votes=[]),null==this.judges&&(this.judges=[]),null==this.shadows&&(this.shadows=[]),null==this.roles&&(this.roles=null)}return n.prototype.getSpeakerRoles=function(){var t,n,s,e,o,r;if(e=[{roles:[]},{roles:[]}],this.roles){for(t=o=0;1>=o;t=++o)for(n=r=0;3>=r;n=++r)e[t].roles.push(this.roles[t][n]);return e}return s=function(t,n){var s,e,o,r,l;if(e=t.players.length){for(s=o=0;2>=o;s=++o)n.push(t.players[s%e]);return n.push(t.players[0])}for(l=[],s=r=0;3>=r;s=++r)l.push(n.push(null));return l},s(this.teams[0],e[0].roles),s(this.teams[1],e[1].roles),e},n.prototype.getVotesForBallots=function(n){var s,e,o,r,l,i,u,a,h,c,d,p,m,f,y;if(s=function(t){return JSON.parse(JSON.stringify(t))},this.votes&&this.votes.length){for(h=[],y=this.votes,c=0,f=y.length;f>c;c++)a=y[c],h.push(t.deepCopy(a,["judge"]));return h}if(r=this.judges,i=r.length,h=[],u=function(t,n){return null==n&&(n=1),a={},a.judge=t,a.ballots=n,a.prop=n,a.opp=0,a.scores=[[70,70,70,35],[70,70,70,35]],a},i)if(i>=n)for(o=d=0;n>=0?n>d:d>n;o=n>=0?++d:--d)h.push(u(r[o]));else for(e=n/i,l=n%i,o=p=0;i>=0?i>p:p>i;o=i>=0?++p:--p)h.push(u(r[o],e+(l>o?1:0)));else for(o=m=0;n>=0?n>m:m>n;o=n>=0?++m:--m)h.push(u(null));return h},n.prototype.unpackCycles=function(){var n,s,e,o,r;if(this.teams[0]=t.unpackCycle(this.teams[0],this.round.tournament.teams),this.teams[1]=t.unpackCycle(this.teams[1],this.round.tournament.teams),this.room=t.unpackCycle(this.room,this.round.tournament.rooms),t.unpackCycles(this.judges,this.round.tournament.judges),t.unpackCycles(this.shadows,this.round.tournament.judges),null!=this.roles){for(r=[],n=o=0;1>=o;n=++o)null!=this.teams[n]&&(e=this.roles[n],r.push(function(){var o,r,l;for(l=[],s=o=0,r=e.length;r>=0?r>o:o>r;s=r>=0?++o:--o)l.push(e[s]=t.unpackCycle(e[s],this.teams[n].players));return l}.call(this)));return r}},n.prototype.toJSON=function(){var n,s,e,o,r,l,i,u;if(s=t.copyObject(this,["round","stats"]),s.teams=[t.packCycle(this.teams[0],this.round.tournament.teams),t.packCycle(this.teams[1],this.round.tournament.teams)],null!=this.roles)for(s.roles=[[],[]],n=l=0;1>=l;n=++l)if(null!=this.teams[n])for(o=s.roles[n],r=this.roles[n],i=0,u=r.length;u>i;i++)e=r[i],o.push(t.packCycle(e,this.teams[n].players));return s.room=t.packCycle(this.room,this.round.tournament.rooms),s.judges=t.packCycles(this.judges,this.round.tournament.judges),s.shadows=t.packCycles(this.shadows,this.round.tournament.judges),s},n.prototype.destroy=function(){return this.team?this.team.removePlayer(this):void 0},n}()})}).call(this);