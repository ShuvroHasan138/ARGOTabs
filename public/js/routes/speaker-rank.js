(function(){define(["player","util","underscore"],function(a,b){return function(c,d){return d.when("/speaker-rank",{templateUrl:"partials/speaker-rank.html",controller:["$scope",function(c){var d,e,f;return d=function(){var a,b,d,e,f,g,h,i,j,k;e=c.tournament,b=e.rankFromSpeakers,a={};if(b.all){j=e.rounds;for(f=0,h=j.length;f<h;f++)d=j[f],d.paired&&(a[d.id]=!0)}else{k=e.rounds;for(g=0,i=k.length;g<i;g++)d=k[g],d.paired&&b[d.id]&&(a[d.id]=!0)}return a},e=function(a){var b,e,f,g,h;b=[],a==null&&(a=d()),h=c.tournament.rounds;for(f=0,g=h.length;f<g;f++)e=h[f],a[e.id]&&b.push(e);return b},c.refreshStats=function(d){var f,g,h,i,j,k,l,m,n,o,p,q;o=c.tournament,k=c.players=o.players.slice(0),d==null&&(d=e()),a.calculateStats(k,d),n=o.speakerRankSorter.boundComparator(),k.sort(function(a,b){var c,d;return d=a.stats.roundsPlayed<o.minPlayed,c=b.stats.roundsPlayed<o.minPlayed,c===d?n(a.stats,b.stats):c?-1:1}),console.log(k),i=0,h=0,g=0;for(p=0,q=k.length;p<q;p++)j=k[p],m=b.decimalsOf(j.stats.score,2),l=b.decimalsOf(j.stats.reply,2),f=b.decimalsOf(j.stats.scoreHighLow,2),m>i&&(i=m),l>h&&(h=l),f>g&&(g=f);return c.scoreDec=i,c.replyDec=h,c.highLowDec=g},f=null,b.installScopeUtils(c),c.$watch(function(){return JSON.stringify(f=d())},function(a){return c.refreshStats(e(f))})}]})}})}).call(this)