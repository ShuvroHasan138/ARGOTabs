(function(){define(["team","util","underscore"],function(a,b){return function(c,d){return d.when("/team-rank",{templateUrl:"partials/team-rank.html",controller:["$scope",function(c){var d,e,f;return d=function(){var a,b,d,e,f,g,h,i,j,k;e=c.tournament,b=e.rankFromTeams,a={};if(b.all){j=e.rounds;for(f=0,h=j.length;f<h;f++)d=j[f],d.paired&&(a[d.id]=!0)}else{k=e.rounds;for(g=0,i=k.length;g<i;g++)d=k[g],d.paired&&b[d.id]&&(a[d.id]=!0)}return a},e=function(a){var b,e,f,g,h;b=[],a==null&&(a=d()),h=c.tournament.rounds;for(f=0,g=h.length;f<g;f++)e=h[f],a[e.id]&&b.push(e);return b},c.refreshStats=function(d){var f,g,h,i,j,k,l,m,n,o,p,q;o=c.tournament,n=c.teams=o.teams.slice(0),d==null&&(d=e()),a.calculateStats(n,d),l=o.teamRankSorter.boundComparator(),n.sort(function(a,b){return l(a.stats,b.stats)}),i=0,h=0,g=0;for(p=0,q=n.length;p<q;p++)m=n[p],k=b.decimalsOf(m.stats.score,2),j=b.decimalsOf(m.stats.reply,2),f=b.decimalsOf(m.stats.scoreHighLow,2),k>i&&(i=k),j>h&&(h=j),f>g&&(g=f);return c.scoreDec=i,c.replyDec=h,c.highLowDec=g},f=null,b.installScopeUtils(c),c.$watch(function(){return JSON.stringify(f=d())},function(a){return c.refreshStats(e(f))})}]})}})}).call(this)