(function(){define(["team","util","underscore"],function(t,e){return function(n,r){return r.when("/team-rank",{templateUrl:"partials/team-rank.html",controller:["$scope",function(n){var r,o,i;return r=function(){var t,e,r,o,i,s,a,l,u,c;if(o=n.tournament,e=o.rankFromTeams,t={},e.all)for(u=o.rounds,i=0,a=u.length;a>i;i++)r=u[i],r.paired&&(t[r.id]=!0);else for(c=o.rounds,s=0,l=c.length;l>s;s++)r=c[s],r.paired&&e[r.id]&&(t[r.id]=!0);return t},o=function(t){var e,o,i,s,a;for(e=[],null==t&&(t=r()),a=n.tournament.rounds,i=0,s=a.length;s>i;i++)o=a[i],t[o.id]&&e.push(o);return e},n.refreshStats=function(r){var i,s,a,l,u,c,d,h,p,f,m,g;for(f=n.tournament,p=n.teams=f.teams.slice(0),null==r&&(r=o()),t.calculateStats(p,r),d=f.teamRankSorter.boundComparator(),p.sort(function(t,e){return d(t.stats,e.stats)}),l=0,a=0,s=0,m=0,g=p.length;g>m;m++)h=p[m],c=e.decimalsOf(h.stats.score,2),u=e.decimalsOf(h.stats.reply,2),i=e.decimalsOf(h.stats.scoreHighLow,2),c>l&&(l=c),u>a&&(a=u),i>s&&(s=i);return n.scoreDec=l,n.replyDec=a,n.highLowDec=s},i=null,e.installScopeUtils(n),n.$watch(function(){return JSON.stringify(i=r())},function(){return n.refreshStats(o(i))})}]})}})}).call(this);