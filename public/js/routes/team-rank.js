(function(){define(["team","util","underscore"],function(t,e){return function(n,r){return r.when("/team-rank",{templateUrl:"partials/team-rank.html",controller:["$scope",function(n){var r,o,i;return r=function(){var t,e,r,o,i,a,s,l,u,c;if(o=n.tournament,e=o.rankFromTeams,t={},e.all)for(u=o.rounds,i=0,s=u.length;s>i;i++)r=u[i],r.paired&&(t[r.id]=!0);else for(c=o.rounds,a=0,l=c.length;l>a;a++)r=c[a],r.paired&&e[r.id]&&(t[r.id]=!0);return t},o=function(t){var e,o,i,a,s;for(e=[],null==t&&(t=r()),s=n.tournament.rounds,i=0,a=s.length;a>i;i++)o=s[i],t[o.id]&&e.push(o);return e},n.refreshStats=function(r){var i,a,s,l,u,c,d,f,p,h,m,g;for(h=n.tournament,p=n.teams=h.teams.slice(0),null==r&&(r=o()),t.calculateStats(p,r),d=h.teamRankSorter.boundComparator(),p.sort(function(t,e){return d(t.stats,e.stats)}),l=0,s=0,a=0,m=0,g=p.length;g>m;m++)f=p[m],c=e.decimalsOf(f.stats.score,2),u=e.decimalsOf(f.stats.reply,2),i=e.decimalsOf(f.stats.scoreHighLow,2),c>l&&(l=c),u>s&&(s=u),i>a&&(a=i);return n.scoreDec=l,n.replyDec=s,n.highLowDec=a},i=null,e.installScopeUtils(n),n.$watch(function(){return JSON.stringify(i=r())},function(){return n.refreshStats(o(i))})}]})}})}).call(this);