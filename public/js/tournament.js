!function(){define(["util","club","team","judge","room","player","round","sorter"],function(t,e,n,r,o,i,s,a){var l;return l=function(){function l(t){this.backend=t,this.clubs=[]}return l.prototype.load=function(t){var l=this;return this.backend.load(function(u){var c,d,h,f,p,m,v,g,y,b,w,k,C,x,S,j,I,R,T,O,N,A,q,_,P,J,M,E,$,B,D,H,W,L,F,z,X,Y,G,V,U,K,Q,Z,te,ee;try{p=JSON.parse(u)}catch(ne){}null==p&&(p={}),l.clubs=[],l.teams=[],l.judges=[],l.rooms=[],l.players=[],l.rounds=[],l.tableOpts={},l.ballotsPerMatch=1,l.maxMainJudges=1e4,l.maxShadowJudges=1e4,l.maxPanelSize=1e4,l.minPlayed=1,null==l.rankFromTeams&&(l.rankFromTeams={all:!0});for(f in p)b=p[f],l[f]=b;for(W=l.clubs,d=w=0,S=W.length;S>w;d=++w)c=W[d],l.clubs[d]=new e(l,c);for(L=l.teams,d=k=0,j=L.length;j>k;d=++k)y=L[d],l.teams[d]=new n(l,y);for(X=l.judges,d=C=0,T=X.length;T>C;d=++C)h=X[d],l.judges[d]=new r(l,h);for(Y=l.rooms,d=x=0,O=Y.length;O>x;d=++x)v=Y[d],l.rooms[d]=new o(l,v);for(G=l.players,d=M=0,N=G.length;N>M;d=++M)m=G[d],l.players[d]=new i(l,m);for(V=l.rounds,d=E=0,A=V.length;A>E;d=++E)g=V[d],l.rounds[d]=new s(l,g);for(U=l.clubs,$=0,q=U.length;q>$;$++)c=U[$],c.unpackCycles();for(K=l.teams,B=0,_=K.length;_>B;B++)y=K[B],y.unpackCycles();for(Q=l.judges,D=0,P=Q.length;P>D;D++)h=Q[D],h.unpackCycles();for(Z=l.rooms,H=0,J=Z.length;J>H;H++)v=Z[H],v.unpackCycles();for(F=l.players,te=0,I=F.length;I>te;te++)m=F[te],m.unpackCycles();for(z=l.rounds,ee=0,R=z.length;R>ee;ee++)g=z[ee],g.unpackCycles();l.teamRankSorter=a.teamRankSorter(p.teamRankSorter),l.pairRankSorter=a.teamRankSorter(p.pairRankSorter),l.lastData=l.toFile(),t()})},l.prototype.roundWithId=function(t){var e,n,r,o;for("string"==typeof t&&(t=parseInt(t)),o=this.rounds,n=0,r=o.length;r>n;n++)if(e=o[n],e.id===t)return e;return null},l.prototype.toJSON=function(){return t.copyObject(this,["backend","lastData"])},l.prototype.toFile=function(){return JSON.stringify(this)},l.prototype.save=function(t,e){return null==e&&(e=!1),this.saveData(this.toFile(),t,e)},l.prototype.saveIfRequired=function(t,e){var n;return null==e&&(e=!1),n=this.toFile(),this.lastData===n?!1:(this.saveData(n,t,e),!0)},l.prototype.saveData=function(t,e,n){var r=this;return null==n&&(n=!1),this.backend.save(t,function(){return r.lastData=t,e()},n)},l}()})}.call(this);