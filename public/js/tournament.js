(function(){define(["util","club","team","judge","room","player","round","sorter"],function(t,e,n,r,o,i,s,a){var l;return l=function(){function l(t){this.backend=t,this.clubs=[]}return l.prototype.load=function(t){var l=this;return this.backend.load(function(u){var d,c,h,f,p,m,g,v,y,b,w,k,x,C,S,j,I,R,T,_,q,J,O,A,E,$,N,M,H,P,L,B,D,W,F,z,G,X,Y,V,U,K,Q,Z,te,ee;try{p=JSON.parse(u)}catch(ne){}null==p&&(p={}),l.clubs=[],l.teams=[],l.judges=[],l.rooms=[],l.players=[],l.rounds=[],l.tableOpts={},l.ballotsPerMatch=1,l.maxMainJudges=1e4,l.maxShadowJudges=1e4,l.maxPanelSize=1e4,l.minPlayed=1,null==l.allowShadows&&(l.allowShadows=!0),null==l.rankFromTeams&&(l.rankFromTeams={all:!0});for(f in p)b=p[f],l[f]=b;for(D=l.clubs,c=w=0,S=D.length;S>w;c=++w)d=D[c],l.clubs[c]=new e(l,d);for(W=l.teams,c=k=0,j=W.length;j>k;c=++k)y=W[c],l.teams[c]=new n(l,y);for(G=l.judges,c=x=0,T=G.length;T>x;c=++x)h=G[c],l.judges[c]=new r(l,h);for(X=l.rooms,c=C=0,_=X.length;_>C;c=++C)g=X[c],l.rooms[c]=new o(l,g);for(Y=l.players,c=N=0,q=Y.length;q>N;c=++N)m=Y[c],l.players[c]=new i(l,m);for(V=l.rounds,c=M=0,J=V.length;J>M;c=++M)v=V[c],l.rounds[c]=new s(l,v);for(U=l.clubs,H=0,O=U.length;O>H;H++)d=U[H],d.unpackCycles();for(K=l.teams,P=0,A=K.length;A>P;P++)y=K[P],y.unpackCycles();for(Q=l.judges,L=0,E=Q.length;E>L;L++)h=Q[L],h.unpackCycles();for(Z=l.rooms,B=0,$=Z.length;$>B;B++)g=Z[B],g.unpackCycles();for(F=l.players,te=0,I=F.length;I>te;te++)m=F[te],m.unpackCycles();for(z=l.rounds,ee=0,R=z.length;R>ee;ee++)v=z[ee],v.unpackCycles();l.teamRankSorter=a.teamRankSorter(p.teamRankSorter),l.pairRankSorter=a.teamRankSorter(p.pairRankSorter),l.lastData=l.toFile(),t()})},l.prototype.roundWithId=function(t){var e,n,r,o;for("string"==typeof t&&(t=parseInt(t)),o=this.rounds,n=0,r=o.length;r>n;n++)if(e=o[n],e.id===t)return e;return null},l.prototype.toJSON=function(){var e,n,r,o,i,s;for(e=t.copyObject(this,["backend","lastData"]),e.rankFromTeams={all:this.rankFromTeams.all},s=this.rounds,o=0,i=s.length;i>o;o++)n=s[o],r=this.rankFromTeams[n.id],null!=r&&(e.rankFromTeams[id]=r);return e},l.prototype.toFile=function(t){return null==t&&(t=!1),t?JSON.stringify(this,null,2):JSON.stringify(this)},l.prototype.save=function(t,e){return null==e&&(e=!1),this.saveData(this.toFile(),t,e)},l.prototype.saveIfRequired=function(t,e){var n;return null==e&&(e=!1),n=this.toFile(),this.lastData===n?!1:(this.saveData(n,t,e),!0)},l.prototype.saveData=function(t,e,n){var r=this;return null==n&&(n=!1),this.backend.save(t,function(){return r.lastData=t,e()},n)},l}()})}).call(this);