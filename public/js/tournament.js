(function(){define(["placeholderbackend","util","club","team","judge","room","player","round","sorter","judgerules"],function(a,b,c,d,e,f,g,h,i,j){var k;return k=function(){function k(a){this.backend=a,this.clubs=[]}return k.prototype.load=function(a){var b=this;return this.backend.load(function(k){var l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,$,_,ba,bb,bc;try{p=JSON.parse(k)}catch(bd){}p==null&&(p={}),b.clubs=[],b.teams=[],b.judges=[],b.rooms=[],b.players=[],b.rounds=[],b.tableOpts={},b.ballotsPerMatch=1,b.evenBrackets=0,b.matchesPerBracket=1,b.maxMainJudges=1e4,b.maxShadowJudges=1e4,b.maxPanelSize=1e4,b.judgeMainPriority=0,b.judgeMainOrder=0,b.judgeShadowPriority=0,b.judgeShadowOrder=0,b.judgeShadowReport=!1,b.minPlayed=1,b.allowShadows==null&&(b.allowShadows=!0),b.rankFromTeams==null&&(b.rankFromTeams={all:!0}),b.rankFromSpeakers==null&&(b.rankFromSpeakers={all:!0});for(o in p)u=p[o],b[o]=u;R=b.clubs;for(m=v=0,z=R.length;v<z;m=++v)l=R[m],b.clubs[m]=new c(b,l);S=b.teams;for(m=w=0,A=S.length;w<A;m=++w)t=S[m],b.teams[m]=new d(b,t);V=b.judges;for(m=x=0,D=V.length;x<D;m=++x)n=V[m],b.judges[m]=new e(b,n);W=b.rooms;for(m=y=0,E=W.length;y<E;m=++y)r=W[m],b.rooms[m]=new f(b,r);X=b.players;for(m=L=0,F=X.length;L<F;m=++L)q=X[m],b.players[m]=new g(b,q);Y=b.rounds;for(m=M=0,G=Y.length;M<G;m=++M)s=Y[m],b.rounds[m]=new h(b,s);Z=b.clubs;for(N=0,H=Z.length;N<H;N++)l=Z[N],l.unpackCycles();$=b.teams;for(O=0,I=$.length;O<I;O++)t=$[O],t.unpackCycles();_=b.judges;for(P=0,J=_.length;P<J;P++)n=_[P],n.unpackCycles();ba=b.rooms;for(Q=0,K=ba.length;Q<K;Q++)r=ba[Q],r.unpackCycles();T=b.players;for(bb=0,B=T.length;bb<B;bb++)q=T[bb],q.unpackCycles();U=b.rounds;for(bc=0,C=U.length;bc<C;bc++)s=U[bc],s.unpackCycles();b.speakerRankSorter=i.speakerRankSorter(p.speakerRankSorter),b.teamRankSorter=i.teamRankSorter(p.teamRankSorter),b.pairRankSorter=i.teamRankSorter(p.pairRankSorter),b.judgeRules=j.mainRules(b,p.judgeRules),b.lastData=b.toFile(),a()})},k.prototype.roundWithId=function(a){var b,c,d,e;typeof a=="string"&&(a=parseInt(a)),e=this.rounds;for(c=0,d=e.length;c<d;c++){b=e[c];if(b.id===a)return b}return null},k.prototype.toJSON=function(){var a,c,d,e,f,g;a=b.copyObject(this,["backend","lastData"]),a.rankFromTeams={all:this.rankFromTeams.all},g=this.rounds;for(e=0,f=g.length;e<f;e++)c=g[e],d=this.rankFromTeams[c.id],d!=null&&(a.rankFromTeams[c.id]=d);return a},k.prototype.toFile=function(a){return a==null&&(a=!1),a?JSON.stringify(this,null,2):JSON.stringify(this)},k.prototype.save=function(a,b){return b==null&&(b=!1),this.saveData(this.toFile(),a,b)},k.prototype.saveIfRequired=function(a,b){var c;return b==null&&(b=!1),c=this.toFile(),this.lastData===c?!1:(this.saveData(c,a,b),!0)},k.prototype.saveData=function(a,b,c){var d=this;return c==null&&(c=!1),this.backend.save(a,function(){return d.lastData=a,b()},c)},k.prototype.clubWithName=function(a){var b,c,d,e;e=this.clubs;for(c=0,d=e.length;c<d;c++){b=e[c],console.log(b.name,a);if(b.name===a)return b}return null},k.prototype.addClub=function(a){var b;return console.log("addClub",a),b=new c(this),this.clubs.push(b),b.name=a,b},k.prototype.addTeam=function(a,b,c){var e,f,g,h,i,j;e=this.clubWithName(b),e==null&&(e=this.addClub(b)),h=new d(this),h.name=a,h.club=e,e.addTeam(h);for(i=0,j=c.length;i<j;i++)f=c[i],g=h.addPlayer(),g.name=f;return this.teams.push(h),h},k.prototype.addJudge=function(a,b,c){var d,f;return c==null&&(c=0),d=this.clubWithName(b),d==null&&(d=this.addClub(b)),c===-1&&(c=e.shadowRank),f=new e(this),f.name=a,f.club=d,f.rank=c,d.addJudge(f),this.judges.push(f),f},k.prototype.destroyEntityInJudgeRules=function(a){var b,c,d,e,f;this.judgeRules.entityDestroyed(a),e=this.rounds,f=[];for(c=0,d=e.length;c<d;c++)b=e[c],f.push(b.judgeRules.entityDestroyed(a));return f},k.placeholderTournament=new k(new a),k.placeholderTournament.load(function(){}),k}()})}).call(this)