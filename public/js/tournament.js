(function(){define(["util","club","team","judge","room","player","round","sorter","judgerules"],function(t,e,n,r,o,i,s,a,l){var u;return u=function(){function u(t){this.backend=t,this.clubs=[]}return u.prototype.load=function(t){var u=this;return this.backend.load(function(d){var c,h,p,f,m,g,v,y,b,w,k,S,C,j,x,R,I,M,O,A,T,P,E,_,N,J,q,$,B,H,L,W,D,F,X,G,z,Y,U,V,K,Q,Z,te,ee,ne;try{m=JSON.parse(d)}catch(re){}null==m&&(m={}),u.clubs=[],u.teams=[],u.judges=[],u.rooms=[],u.players=[],u.rounds=[],u.tableOpts={},u.ballotsPerMatch=1,u.evenBrackets=1,u.matchesPerBracket=1,u.maxMainJudges=1e4,u.maxShadowJudges=1e4,u.maxPanelSize=1e4,u.judgeMainPriority=0,u.judgeMainOrder=0,u.judgeShadowPriority=0,u.judgeShadowOrder=0,u.judgeShadowReport=!1,u.minPlayed=1,null==u.allowShadows&&(u.allowShadows=!0),null==u.rankFromTeams&&(u.rankFromTeams={all:!0}),null==u.rankFromSpeakers&&(u.rankFromSpeakers={all:!0});for(f in m)w=m[f],u[f]=w;for(D=u.clubs,h=k=0,x=D.length;x>k;h=++k)c=D[h],u.clubs[h]=new e(u,c);for(F=u.teams,h=S=0,R=F.length;R>S;h=++S)b=F[h],u.teams[h]=new n(u,b);for(z=u.judges,h=C=0,O=z.length;O>C;h=++C)p=z[h],u.judges[h]=new r(u,p);for(Y=u.rooms,h=j=0,A=Y.length;A>j;h=++j)v=Y[h],u.rooms[h]=new o(u,v);for(U=u.players,h=q=0,T=U.length;T>q;h=++q)g=U[h],u.players[h]=new i(u,g);for(V=u.rounds,h=$=0,P=V.length;P>$;h=++$)y=V[h],u.rounds[h]=new s(u,y);for(K=u.clubs,B=0,E=K.length;E>B;B++)c=K[B],c.unpackCycles();for(Q=u.teams,H=0,_=Q.length;_>H;H++)b=Q[H],b.unpackCycles();for(Z=u.judges,L=0,N=Z.length;N>L;L++)p=Z[L],p.unpackCycles();for(te=u.rooms,W=0,J=te.length;J>W;W++)v=te[W],v.unpackCycles();for(X=u.players,ee=0,I=X.length;I>ee;ee++)g=X[ee],g.unpackCycles();for(G=u.rounds,ne=0,M=G.length;M>ne;ne++)y=G[ne],y.unpackCycles();u.speakerRankSorter=a.speakerRankSorter(m.speakerRankSorter),u.teamRankSorter=a.teamRankSorter(m.teamRankSorter),u.pairRankSorter=a.teamRankSorter(m.pairRankSorter),u.judgeRules=l.mainRules(u,m.judgeRules),u.lastData=u.toFile(),t()})},u.prototype.roundWithId=function(t){var e,n,r,o;for("string"==typeof t&&(t=parseInt(t)),o=this.rounds,n=0,r=o.length;r>n;n++)if(e=o[n],e.id===t)return e;return null},u.prototype.toJSON=function(){var e,n,r,o,i,s;for(e=t.copyObject(this,["backend","lastData"]),e.rankFromTeams={all:this.rankFromTeams.all},s=this.rounds,o=0,i=s.length;i>o;o++)n=s[o],r=this.rankFromTeams[n.id],null!=r&&(e.rankFromTeams[n.id]=r);return e},u.prototype.toFile=function(t){return null==t&&(t=!1),t?JSON.stringify(this,null,2):JSON.stringify(this)},u.prototype.save=function(t,e){return null==e&&(e=!1),this.saveData(this.toFile(),t,e)},u.prototype.saveIfRequired=function(t,e){var n;return null==e&&(e=!1),n=this.toFile(),this.lastData===n?!1:(this.saveData(n,t,e),!0)},u.prototype.saveData=function(t,e,n){var r=this;return null==n&&(n=!1),this.backend.save(t,function(){return r.lastData=t,e()},n)},u}()})}).call(this);