!function(){define(["util","player"],function(t,e){var n;return n=function(){function n(t,e){var n,r,o,i,s,a;if(this.tournament=t,e)for(n in e)o=e[n],this[n]=o;if(null==this.name&&(this.name=""),null==this.players&&(this.players=[]),null==this.rounds&&(this.rounds={}),!e)for(a=this.tournament.rounds,i=0,s=a.length;s>i;i++)r=a[i],r.registerTeam(this)}return n.prototype.unpackCycles=function(){var e,n,r,o,i;this.club=t.unpackCycle(this.club,this.tournament.clubs),t.unpackCycles(this.players,this.tournament.players),o=this.rounds,i=[];for(e in o)n=o[e],r=this.tournament.roundWithId(e),r&&null!=n.ballot?i.push(n.ballot=t.unpackCycle(n.ballot,r.ballots)):i.push(void 0);return i},n.prototype.toJSON=function(){var e,n,r,o,i,s;n=t.copyObject(this,["tournament","rounds","stats"]),n.club=t.packCycle(this.club,this.tournament.clubs),n.players=t.packCycles(this.players,this.tournament.players),n.rounds={},s=this.rounds;for(e in s)o=s[e],i=this.tournament.roundWithId(e),n.rounds[e]=r=t.copyObject(o),i&&o.ballot&&(r.ballot=t.packCycle(o.ballot,i.ballots));return n},n.calculateStats=function(t,e){var n,r,o,i;for(i=[],r=0,o=t.length;o>r;r++)n=t[r],i.push(n.stats=n.getStats(e));return i},n.prototype.getStats=function(t){var e,n,r,o,i,s,a,l,u,d,c,h,f,p,m,v,g,y,b;for(s={rawWins:0,rawScore:0,rawReply:0,rawHLScore:0,rawHLRounds:0,rawBallots:0,byeWins:0,byeBallots:0,byeHLRounds:0,wins:0,score:0,reply:0,scoreHighLow:0,ballots:0,roundsPlayed:0,roundsBotched:0},p=0,g=t.length;g>p;p++)if(l=t[p],"object"==typeof l&&(l=l.id),r=this.rounds[l].ballot,r.locked){if(this===r.teams[0])c=0;else{if(this!==r.teams[1])continue;c=1}if(r.presence[c])if(r.presence[1-c]&&r.teams[1-c]){for(s.roundsPlayed++,d=0,a=0,o=0,f=0,b=r.votes,m=0,y=b.length;y>m;m++){for(h=b[m],i=v=0;4>v;i=++v)d+=h.scores[c][i]*h.ballots;a+=h.scores[c][3]*h.ballots,o+=h.ballots,f+=c?h.opp:h.prop}f>o-f&&s.rawWins++,s.rawBallots+=f,o&&(d/=o,a/=o),s.rawScore+=d,s.rawReply+=a}else s.byeWins++,s.byeBallots+=l.ballotsPerMatchSolved();else s.roundsBotched++}return s.wins=s.rawWins+s.byeWins,s.ballots=s.rawBallots+s.byeBallots,u=s.roundsPlayed+s.roundsBotched,n=245,e=35,s.score=s.rawScore+s.byeWins*(u?s.rawScore/u:n),s.reply=s.rawReply+s.byeWins*(u?s.rawReply/u:e),u=s.rawHLRounds,s.scoreHighLow=s.rawHLScore+s.byeHLRounds*(u?s.rawHLScore/u:245),s.wins=s.rawWins+s.byeWins,s.ballots=s.rawBallots+s.byeBallots,s},n.prototype.addPlayer=function(){var t;return t=new e(this.tournament),this.players.push(t),this.tournament.players.push(t),t.team=this},n.prototype.removePlayer=function(t){var e;return e=this.players.indexOf(t),this.players.splice(e,1)},n.prototype.removePlayerAtIndex=function(t){var e,n,r;return r=this.players[t],this.players.splice(t,1),e=this.tournament.players,n=e.indexOf(r),e.splice(n,1)},n.prototype.destroy=function(){var t,e,n,r;for(r=this.tournament.rounds,e=0,n=r.length;n>e;e++)t=r[e],t.unregisterTeam(this);return this.club?this.club.removeTeam(this):void 0},n}()})}.call(this);